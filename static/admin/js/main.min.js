/* -----------贝安港后台登录------------
 * main.js v1
 * http://www.encorehe.com/
 * Created & Modified by hejiachao
 * Date modified 2016-02.05
 *
 * Copyright 2013-2016 武汉缘诚科技 All rights reserved.
 * Licensed under MIT license.
 * http://opensource.org/licenses/MIT
 * eg:主体内容 列表及表格数据的获取展现，数据增、删、改、查
 */_dataParams={};var ths,it,listUrl,editUrl,addUrl,delUrl,qiyongUrl,addTpl,editTpl,chkTpl,addArea,editArea,chkArea,datasCur,chkTitle,addTitle,editTitle,delTitle,titleStart,titleEnd,mmg,indexCol,checkCol,cols,root,allData=[],itemsc=[],addCallback,editCallback,chkCallback,resetPwdUrl,resetFun=false,resetFunAdd,resetFunEdit,resetFunDel,tabArea,tabOption,tabCallback,currentUrl,zhuangtaiTag;var mainCont={getList:function(items,options,callback){it=items;ths=mainCont;var opt=options[0];listUrl=opt.url.list;editUrl=opt.url.edit;addUrl=opt.url.add;delUrl=opt.url.del;qiyongUrl=opt.url.del+"?isUse\x3d1";addTpl=opt.tpl.add;editTpl=opt.tpl.edit;chkTpl=opt.tpl.chk;addArea=opt.area.add;editArea=opt.area.edit;chkArea=opt.area.chk;addTitle=opt.title.add;editTitle=opt.title.edit;chkTitle=opt.title.chk;delTitle=opt.title.del;titleStart=opt.title.titleStart;titleEnd=opt.title.titleEnd;indexCol=opt.mmg.indexCol;checkCol=opt.mmg.checkCol;root=opt.mmg.root;if(opt.params);if(opt.callback){addCallback=opt.callback.add;editCallback=opt.callback.edit;chkCallback=opt.callback.chk}if(opt.url.resetPwdUrl&&opt.url.resetPwdUrl.length>0)resetPwdUrl=opt.url.resetPwdUrl;if(opt.resetFun){resetFun=true;resetFunAdd=opt.resetFun.add;resetFunEdit=opt.resetFun.edit;resetFunDel=opt.resetFun.del}if(opt.tab){tabArea=opt.tab.area;tabOption=opt.tab.option;tabCallback=opt.tab.callback}currentUrl=listUrl;ths.mmGrids(currentUrl);if(callback)callback()},mmGrids:function(url){mmg=$("#mmg").mmGrid({multiSelect:true,indexCol:indexCol,checkCol:checkCol,indexColWidth:25,cols:it,root:root,width:"auto",height:"auto",fullWidthRows:true,autoLoad:true,noDataText:"\u5f53\u524d\u67e5\u8be2\u672a\u83b7\u53d6\u5230\u4efb\u4f55\u4fe1\u606f",url:url,items:it,cache:false,sortStatus:"asc",nowrap:false,method:"post",showBackboard:false,params:_dataParams,plugins:[$("#paginator").mmPaginator({style:"plain",totalCountName:"totalCount",page:_dataParams.page,pageParamName:"page",limitParamName:"count",limitLabel:"\u6bcf\u9875{0}\u6761",totalCountLabel:"\u5171\x3cspan\x3e{0}\x3c/span\x3e\u6761\u8bb0\u5f55",limit:it,limitList:[20,30,40,50]})]}).on("loadSuccess",function(e,data){if(data)allData=data.list;$(".mmg-bodyWrapper").mCustomScrollbar("destroy");common.iframeLayerMsg("\u6570\u636e\u52a0\u8f7d\u5b8c\u6210",1,mainCont.scrollBar());$(".mmg-check").on("click",function(e){var t=$(this),tpp=t.parent().parent();tpp.click()});$(".J-searchForm").submit(function(e){e.preventDefault()});var sbtn=$(".J-searchBtn");sbtn.removeClass("disabled");sbtn.unbind("click").click(function(e){e.preventDefault();sbtn.addClass("disabled");common.creatSearch();mmg.load(_dataParams)})});ths.actionBar();if(mmg){var selectItem=$(".action .J-search select");selectItem.on("change",function(e){e.stopPropagation();var t=$(this),tname=t.data("name");if(tname=="schoolId"||tname=="classId")return false;else{common.creatSearch();mmg.load(_dataParams)}})}mmg.on("cellSelected",function(e,item,rowIndex,colIndex){var itsc=$(this).find("tbody tr").eq(rowIndex);itemsc.push(item);if($(e.target).is(".J-info")){e.stopPropagation();datasCur=item;datasCur.key=rowIndex;mmg.select(rowIndex);ths.chkDatas(datasCur)}else if($(e.target).is(".J-del")){e.stopPropagation();datasCur=item;ths.delDataF(3,datasCur,delUrl)}else if($(e.target).is(".J-edit")){e.stopPropagation();datasCur=item;datasCur.key=rowIndex;zhuangtaiTag="bianji";mmg.select(rowIndex);ths.editDatas(item)}else if($(e.target).is(".J-resetPwd")){e.stopPropagation();datasCur=item;mmg.select(rowIndex);ths.resetPwd(datasCur)}else if($(e.target).is(".J-tabs")){e.stopPropagation();datasCur=item}else if($(e.target).is(".J-qiyong")){e.stopPropagation();datasCur=item;mmg.select(rowIndex);ths.delDataF(1,datasCur,qiyongUrl)}else if($(e.target).is(".J-tingyong")){e.stopPropagation();datasCur=item;mmg.select(rowIndex);ths.delDataF(0,datasCur,delUrl)}}).on("loadSuccess",function(e,data){}).on("rowInserted",function(e,item,index){}).on("rowUpdated",function(e,oldItem,newItem,index){}).on("rowRemoved",function(e,item,index){})},scrollBar:function(){var _w=$(window);var bdheight=_w.height(),headH=$(".header").height(),breadcrumbH=$(".breadcrumb").height(),iframePh=$(".action").height()+55;var huitab=$(".HuiTab").height()?$(".HuiTab").height():0;var tableH=bdheight-headH-breadcrumbH-iframePh-huitab-$(".mmg-headWrapper").height();$(".mmg-bodyWrapper").css("max-height",tableH);$(".mmg-bodyWrapper").mCustomScrollbar({scrollButtons:{enable:true,scrollType:"continuous",scrollSpeed:20,scrollAmount:40},horizontalScroll:false,theme:"minimal"})},actionBar:function(){$(".checkAll").on("click",function(e){var th=$(this);if(th.prop("checked")==false)itemsc=[];else itemsc=allData});$(".J-delAll,.J-del").on("click",function(e){e.preventDefault();ths.delDataF(3,itemsc,delUrl)});$(".J-tingyongAll").on("click",function(e){e.preventDefault();ths.delDataF(0,itemsc,delUrl)});$(".J-qiyongAll").on("click",function(e){e.preventDefault();ths.delDataF(1,itemsc,qiyongUrl)});$(".J-add").bind("click",function(e){e.preventDefault();zhuangtaiTag="zengjia";ths.addData()})},chkDatas:function(datas){var content=template(chkTpl,datas);successBack=function(){if(chkCallback){chkCallback();$(".layui-layer-btn").remove()}};common.layerConfirm(chkTitle,chkArea,content,successBack)},delDataF:function(type,datas,url){var delData=[],delDatas={};debugger;if(datas.length!=undefined&&datas.length>0){var hashs=$.hash("page");for(var i=0;i<datas.length;i++)if(hashs=="parents")delData.push(datas[i].accountId);else delData.push(datas[i].id);delDatas.id=delData}else{for(var j=0;j<allData.length;j++)if(allData[j].id==datas.id)mmg.select(j);var hashs=$.hash("page");if(hashs=="parents")delData.push(datas.accountId);else delData.push(datas.id);delDatas.id=delData}var _titleEmpty="",_titleQr="",_titleYes="";switch(type){case 0:_titleEmpty="\u60a8\u8fd8\u672a\u9009\u4e2d\u9700\u8981"+titleEnd+"\u7684\u6570\u636e";_titleQr="\u662f\u5426\u786e\u5b9a"+titleEnd+"!";_titleYes=titleEnd+"\u6210\u529f";break;case 1:_titleEmpty="\u60a8\u8fd8\u672a\u9009\u4e2d\u9700\u8981"+titleStart+"\u7684\u6570\u636e";_titleQr="\u662f\u5426\u786e\u5b9a"+titleStart+"!";_titleYes=titleStart+"\u6210\u529f";break;case 3:_titleEmpty="\u60a8\u8fd8\u672a\u9009\u4e2d\u9700\u8981\u5220\u9664\u7684\u6570\u636e";_titleQr="\u662f\u5426\u786e\u5b9a\u5220\u9664!";_titleYes="\u5220\u9664\u6210\u529f";break}if(itemsc.length==0){common.iframeLayerMsg(_titleEmpty,2);return}var yesBack=function(){var beforBacks=function(){},successBack=function(){$(".checkAll").prop("checked",false);common.iframeLayerMsg(_titleYes,1,function(){itemsc=[];mmg.load()})};common.ajaxFunIframe(url,delDatas,beforBacks,successBack)};var cancel=function(){mmg.deselect("all");itemsc=[]};common.layerMsgFlag(_titleQr,yesBack,cancel)},addData:function(){var cont=template(addTpl,{}),success=function(){if(addCallback)addCallback();var eleForm=$(".J-addForm");common.validformSubmit(eleForm)},yes=function(){if(resetFun==true&&resetFunAdd!=null)resetFunAdd();else{var eleForm=$(".J-addForm");var callback=function(){var addFields=eleForm.serialize(),before=function(){},succes=function(){if(ajaxData.success==true)common.iframeLayerMsg("\u6dfb\u52a0\u6210\u529f!",1,function(){sFlag=false;mmg.load(_dataParams)})};common.ajaxFunIframe(addUrl,addFields,before,succes)};common.validformIn(eleForm,callback)}};common.layerConfirm(addTitle,addArea,cont,success,yes)},editDatas:function(datas){var content=template(editTpl,datas),successBack=function(){if(editCallback)editCallback();var formEidt=$(".J-editForm");common.validformSubmit(formEidt)},yesBack=function(){if(resetFun==true&&resetFunEdit!=null)resetFunEdit();else{var formEdit=$(".J-editForm");var i=0;formEdit.submit(function(e){e.preventDefault();common.validformSubmit(formEdit);if(sFlag&&sFlag==true&&i==0){i++;var fields=formEdit.serialize();var beforBack=function(){},successBacks=function(){if(ajaxData.success==true)common.iframeLayerMsg("\u4fee\u6539\u6210\u529f!",1,function(){sFlag=false;mmg.load()})};common.ajaxFunIframe(editUrl,fields,beforBack,successBacks)}else i--});formEdit.submit()}};editLayer=common.layerConfirm(editTitle,editArea,content,successBack,yesBack)},resetPwd:function(data){var _titleQr="\u662f\u5426\u8981\u91cd\u7f6e\u5bc6\u7801",resetId=data.id,resetUname=data.userName;fields={"id":resetId,"userName":resetUname};yesBack=function(){beforBack=function(){};successBacks=function(){if(ajaxData.success==true)common.iframeLayerMsg("\u5bc6\u7801\u91cd\u7f6e\u6210\u529f!",1,function(){mmg.load()})};common.ajaxFunIframe(resetPwdUrl,fields,beforBack,successBacks)};common.layerMsgFlag(_titleQr,yesBack)}};
//@ sourceMappingURL=main.min.js.map