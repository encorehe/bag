options=[];zhuangtaiTags="";var itemscxc=[],babyAll=[],curbabys=[],oldBaby=[],zdCur,kidCur,bag={_init:function(){var a=$busLines;common.powerFlag(temD[1].power);var b=[{title:"\u8def\u7ebf\u540d\u79f0",name:"lineName",width:100,align:"center"},{title:"\u5df4\u58eb\u7c7b\u578b",name:"busType",width:65,align:"center",renderer:function(a,b){var e="";switch(a){case 1:e="\u6b63\u5e38";break;case 2:e="\u52a0\u73ed";break;case 0:e="\u5176\u4ed6"}return e}},{title:"\u7ec8\u7aef\u7f16\u53f7",name:"busTerminalNum",width:80,align:"center"},{title:"\u72b6\u6001",name:"isUse",width:30,align:"center",renderer:function(a,b){var e="";switch(a){case 1:e="\u221a";break;case 0:e="\u00d7"}return e}},{title:"\u4e0a\u5b66\u73ed\u8f66",align:"center",cols:[{title:"\u53d1\u8f66\u65f6\u95f4",name:"toSchDriverTime",width:80,align:"center"},{title:"\u968f\u8f66\u8001\u5e08",name:"toSchTeacherName",width:80,align:"center"}]},{title:"\u653e\u5b66\u73ed\u8f66",align:"center",cols:[{title:"\u53d1\u8f66\u65f6\u95f4",name:"fromSchDriverTime",width:80,align:"center"},{title:"\u968f\u8f66\u8001\u5e08",name:"fromSchTeacherName",width:80,align:"center"}]},{title:"\u64cd\u4f5c",name:"id",width:60,align:"center",renderer:function(a,b){btnsHtml="\x3ca class\x3d'iconfont J-tabs' data-title\x3d'chk' href\x3d'javascript:void(0);' title\x3d'\u8be6\u60c5'\x3e\x26#xe61c;\x3c/a\x3e";editFlagS&&(btnsHtml+="\x3ca class\x3d'iconfont J-tabs' data-title\x3d'bianji' href\x3d'javascript:void(0);' title\x3d'\u7f16\u8f91'\x3e\x26#xe61a;\x3c/a\x3e");return"\x3cspan class\x3d'table-action'\x3e"+btnsHtml+"\x3c/span\x3e"}}],c=common.getCode();1!=c&&2!=c&&3!=c||b.splice(3,0,{title:"\u5b66\u6821",name:"schoolName",width:90,align:"center"});edtiBox=function(){""==$(".J-luxian").html()&&(k(),h())};var d=function(a){a={page:0,count:0};"bianji"==zhuangtaiTags&&(a.schoolId=datasCur.schoolId);"zengjia"==zhuangtaiTag&&(a.schoolId=$('.xiaocheAdd input[name\x3d"schoolId"]').val());f(a)},f=function(a){$.getJSON($teachers.list.url,a,function(a){dataWorkers=a.list;a=[];var e=[];if(dataWorkers&&0<dataWorkers.length)for(var b=0;b<dataWorkers.length;b++)"SJ"==dataWorkers[b].code&&a.push(dataWorkers[b]),"JZG"!=dataWorkers[b].code&&"JS"!=dataWorkers[b].code||e.push(dataWorkers[b]);g(a,e)})},g=function(a,b){var e=template("tplTeachers",{list:a}),c=template("tplTeachers",{list:b});$(".J-siji").html(e);$(".J-teacher").html(c);e=$(".J-siji,.J-teacher");e.on("change",function(){var a=$(this),b=a.find("option:selected").attr("data-telephone");sjInpt=a.parent().parent().next().find("input");sjInpt.val(b)});e.change()},h=function(){var a=template("editTpl",datasCur);$(".J-luxian").html(a);"chk"==zhuangtaiTags&&$(".J-luxian").find(".btn-act").remove();d();(function(){var a=$(".J-editForm");common.validformSubmit(a);a.on("submit",function(b){b.preventDefault();common.validformSubmit(a);sFlag&&1==sFlag&&(sFlag=!1,b=a.serialize(),common.ajaxFunIframe($busLines.edit.url,b,function(){},function(){1==ajaxData.success&&jAlert("\u4fee\u6539\u6210\u529f","\u8d1d\u5b89\u6e2f\u63d0\u793a",function(){layer.closeAll();mmg.load(_dataParams)})}))})})()},k=function(){var a=template("tplZhandian",datasCur);$(".J-zhandian").html(a);"chk"==zhuangtaiTags&&$(".J-addZD").remove();var a=$("#mmgZDs"),b=$("#paginators");zdmmg=bag.creatMmg(a,{indexCol:!0,checkCol:!0,it:[{title:"\u7ad9\u70b9",name:"name",width:120,align:"center"},{title:"\u5e7c\u513f\u6570",name:"kidCount",width:90,align:"center",renderer:function(a){if(null==a||void 0==a||""==a)a=0;return a}},{title:"\u5750\u6807(\u7ecf/\u7eac)",name:"longitude",width:120,align:"center",renderer:function(a,b){return a+"/"+b.latitude}},{title:"\u4e0a\u5b66\u5230\u8fbe\u65f6\u95f4",name:"amTime",width:30,align:"center"},{title:"\u653e\u5b66\u5230\u8fbe\u65f6\u95f4",name:"pmTime",width:100,align:"center"},{title:"\u64cd\u4f5c",name:"code",width:80,align:"center",renderer:function(a,b){btnsHtml="\x3ca class\x3d'iconfont J-info' href\x3d'javascript:void(0);' title\x3d'\u8be6\u60c5'\x3e\x26#xe61c;\x3c/a\x3e";1==editFlagS&&"bianji"==zhuangtaiTags&&(btnsHtml+="\x3ca class\x3d'iconfont J-edit' href\x3d'javascript:void(0);' title\x3d'\u7f16\u8f91'\x3e\x26#xe61a;\x3c/a\x3e");1==delFlag&&"bianji"==zhuangtaiTags&&(btnsHtml+="\x3ca class\x3d'iconfont J-del' href\x3d'javascript:void(0);' title\x3d'\u5220\u9664'\x3e\x26#xe617;\x3c/a\x3e");return"\x3cspan class\x3d'table-action'\x3e"+btnsHtml+"\x3ca class\x3d'iconfont J-renyuan' href\x3d'javascript:void(0);' title\x3d'\u4eba\u5458\u7ba1\u7406'\x3e\x26#xe63c;\x3c/a\x3e\x3c/span\x3e"}}],params:{busLineId:datasCur.id},url:$busStops.list.url},b);zdmmg.on("cellSelected",function(a,b,c,d){d=$(this).find("tbody tr").eq(c);if($(d).hasClass("selected"))for(d=0;d<itemscxc.length;d++)b.id==itemscxc[d].id&&(itemscxc.splice(d,1),d--);else itemscxc.push(b);if($(a.target).is(".J-edit")){b.busLineId=datasCur.id;busStopsData=b;var f=layer.open({title:"\u4fee\u6539\u7ad9\u70b9",closeBtn:2,content:template("tplZdEdit",b),area:["900px","800px"],success:function(){common.biaoZhu(busStopsData.longitude,busStopsData.latitude);var a=$(".J-zdForm");common.validformSubmit(a);common.layerDateHHSS($(a.find(".J-date")))},yes:function(){var a=$(".J-zdForm");common.validformIn(a,function(){var b=a.serialize();common.ajaxFunIframe($busStops.edit.url,b,function(){},function(){1==ajaxData.success&&jAlert("\u7ad9\u70b9\u4fe1\u606f\u4fee\u6539\u6210\u529f!","\u8d1d\u5b89\u6e2f\u63d0\u793a",function(){layer.close(f);zdmmg.load()})})})}})}$(a.target).is(".J-del")&&(zdCur=b,zdmmg.select(c),bag.delDataF(zdCur,$busStops.del.url,zdmmg));$(a.target).is(".J-info")&&(b.busLineId=datasCur.id,busStopsData=b,f=layer.open({type:1,title:"\u67e5\u770b\u7ad9\u70b9",closeBtn:2,content:template("tplZdChk",b),area:["900px","500px"],success:function(){common.biaoZhu(busStopsData.longitude,busStopsData.latitude)}}));$(a.target).is(".J-renyuan")&&(zdCur=b,zdmmg.select(c),layer.open({title:datasCur.lineName+"\u8def\u7ebf\u2014\u2014"+zdCur.name+"\u7ad9\u70b9-\u5b9d\u8d1d\u7ba1\u7406",type:1,content:template("tplBabyBoxs",{}),area:["600px","400px"],closeBtn:2,success:function(){bag.zdbaby()}}))}).on("loadSuccess",function(a,b){});$(".J-addZD").on("click",function(a){a.preventDefault();var b=layer.open({title:"\u6dfb\u52a0\u7ad9\u70b9",closeBtn:2,content:template("tplZdEdit",{busLineId:datasCur.id}),area:["960px","500px"],success:function(){common.biaoZhu();var a=$(".J-zdForm");common.validformSubmit(a);common.layerDateHHSS($(a.find(".J-date")))},yes:function(){var a=$(".J-zdForm");common.validformIn(a,function(){var c=a.serialize();common.ajaxFunIframe($busStops.add.url,c,function(){},function(){1==ajaxData.success&&jAlert("\u6dfb\u52a0\u6210\u529f","\u8d1d\u5b89\u6e2f\u63d0\u793a",function(){layer.close(b);zdmmg.load()})})})}})})};options.push({tpl:{edit:"editTpl",chk:"chkTpl",add:"addTpl"},url:{edit:a.edit.url,add:a.add.url,del:a.del.url,list:a.list.url,resetPwdUrl:a.list.url},area:{edit:a.edit.area,add:a.add.area,del:a.del.area,chk:a.chk.area},title:{edit:a.edit.title,add:a.add.title,del:a.del.title,chk:a.chk.title,titleStart:a.del.titleStart,titleEnd:a.del.titleEnd},callback:{add:function(){common.codeFlag(function(){var a=$(".xiaocheAdd .J-school");eleC=$(".xiaocheAdd .J-class");common.getSchoolItem(a,{page:0,count:0},1,d)},function(){d()});common.layerDateHHSS($(".J-date"))},edit:edtiBox,chk:function(){var a=$(".J-school"),b=$(".J-class");a.text($(".J-schools select option:selected").text());b.text($(".J-classs select option:selected").text());$(".layui-layer-btn").remove()}},mmg:{indexCol:!0,checkCol:!0,root:"list"},tab:{area:["960px","520px"],option:[{title:"\u7ad9\u70b9\u5217\u8868",content:'\x3cdiv class\x3d"tabs J-zhandian"\x3e\x3c/div\x3e'},{title:"\u8def\u7ebf\u4fe1\u606f",content:'\x3cdiv class\x3d"tabs J-luxian"\x3e\x3c/div\x3e'}],callback:function(){edtiBox()}}});bag._do(b,options)},zdbaby:function(){"chk"==zhuangtaiTags&&$(".zdbb").remove();var a=$("#busKid"),b=$("#paginatorBusKid"),c=bag.creatMmg(a,{indexCol:!0,checkCol:!1,it:[{title:"\u59d3\u540d",name:"kidsName",width:120,align:"center"},{title:"\u73ed\u7ea7",name:"className",width:90,align:"center",renderer:function(a){if(null==a||void 0==a||""==a)a=0;return a}},{title:"\u64cd\u4f5c",name:"code",width:80,align:"center",renderer:function(a,b){btnsHtml="chk"==zhuangtaiTags?"":"\x3ca class\x3d'iconfont J-del' href\x3d'javascript:void(0);' title\x3d'\u5220\u9664'\x3e\x26#xe617;\x3c/a\x3e";return"\x3cspan class\x3d'table-action'\x3e"+btnsHtml+"\x3c/span\x3e"}}],params:{busStopId:zdCur.id},url:$busKids.list.url},b);c.on("cellSelected",function(a,b,g,h){$(a.target).is(".J-del")&&(kidCur=b,c.select(g),bag.delDataF(kidCur,$busKids.del.url+"?busStopId\x3d"+zdCur.id,c))}).on("loadSuccess",function(a,b,c,h){b.success&&0<b.list.length&&(oldBaby=b.list)});$(".J-addBb").on("click",function(a){a.preventDefault();var b=layer.open({title:"\u6dfb\u52a0\u7ad9\u70b9\u5b9d\u8d1d",closeBtn:2,content:template("tplBusKids",{}),area:["800px","400px"],success:function(){bag.babyFind()},yes:function(){if(0==curbabys.length)jAlert("\u60a8\u9700\u8981\u9009\u4e2d\u5b9d\u8d1d","\u8d1d\u5b89\u6e2f\u63d0\u793a");else{for(var a=[],d=0;d<curbabys.length;d++)a.push(curbabys[d].id);bag.ajaxSubmitV($busKids.add.url,{busStopId:zdCur.id,kidId:a},function(){ajaxDatas.success&&jAlert("\u6dfb\u52a0\u7ad9\u70b9\u5b9d\u8d1d\u6210\u529f\uff01","\u8d1d\u5b89\u6e2f\u63d0\u793a",function(){curbabys=[];oldBaby=[];layer.close(b);c.load()})})}},end:function(){curbabys=[]}})})},babyFind:function(){var a=$(".layui-layer .J-school-xc"),b=$(".layui-layer .J-class-xc"),c=function(){var c=$kid.list.url,f={busLineId:datasCur.id},g=a.find("select").val(),h=b.find("select").val();void 0==g?(f.page=0,f.count=0,f.schoolId=datasCur.schoolId):(f.page=0,f.count=0,f.schoolId=g);void 0!=h&&0!=h&&(f.classId=h);bag.ajaxSubmitV(c,f,function(){var a="";curbabys=[];if(0<oldBaby.length)for(a=0;a<oldBaby.length;a++)curbabys.push({name:oldBaby[a].kidsName,id:oldBaby[a].kidId});ajaxDatas.success&&0<ajaxDatas.list.length?bag.renderBabyAll():(a="\u65e0\u4eba",$(".J-babys").html(a));bag.renderBaby()})};common.codeFlag(function(){common.getClass(b,1,{schoolId:datasCur.schoolId,page:0,count:0},function(){$(".J-school-xc").text(datasCur.schoolName);c()})},function(){common.getClass(b,1,{page:0,count:0},function(){$(".J-school").text($(".J-sc").text());c()})})},babyCur:function(){$(".layui-layer .J-babys label").on("click",function(){var a=$(this),b=a.index();if(a.hasClass("active"))for(a.removeClass("active"),a.find("input").prop("checked",!1),a=0;a<curbabys.length;a++)curbabys[a].id==babyAll[b].id&&curbabys.splice(a,1);else a.addClass("active"),a.find("input").prop("checked",!0),curbabys.push(babyAll[b]);bag.renderBaby()})},renderBabyAll:function(){babyAll=ajaxDatas.list;if(0<curbabys.length)for(var a=0;a<babyAll.length;a++)for(var b=0;b<curbabys.length;b++)babyAll[a].id==curbabys[b].id&&(babyAll[a].checkedflag=!0);_html=template("tplBaby",{list:babyAll});$(".J-babys").html(_html);bag.babyCur()},renderBaby:function(){$(".J-curBabys").html(template("tplBabyCur",{list:curbabys}));$(".layui-layer .J-curBabys label").on("click",function(){var a=$(this),b=a.index();if(a.hasClass("active"))for(a.remove(),a=0;a<curbabys.length;a++)if(curbabys[a].id==curbabys[b].id){for(var c=0;c<babyAll.length;c++)curbabys[a].id==babyAll[c].id&&(babyAll[c].checkedflag=!1);curbabys.splice(a,1)}bag.renderBaby();bag.renderBabyAll()})},delDataF:function(a,b,c){delD=a;var d=[],f={};if(void 0!=a.length&&0<a.length)for(var g=0;g<a.length;g++)d.push(a[g].id);else{for(g=0;g<allData.length;g++)allData[g].id==a.id&&c.select(g);d.push(a.id)}f.id=d;0==itemsc.length?common.iframeLayerMsg("\u60a8\u8fd8\u672a\u9009\u4e2d\u9700\u8981\u5220\u9664\u7684\u6570\u636e",2):common.layerMsgFlag("\u662f\u5426\u786e\u5b9a\u5220\u9664!",function(){common.ajaxFunIframe(b,f,function(){},function(){for(var a=0;a<oldBaby.length;a++)delD.kidId==oldBaby[a].kidId&&(oldBaby.splice(a,1),a--);$(".checkAll").prop("checked",!1);common.iframeLayerMsg("\u5220\u9664\u6210\u529f",1,function(){itemscxc=[];c.load()})})},function(){c.deselect("all")})},creatMmg:function(a,b,c){return mmgss=$(a).mmGrid({multiSelect:!0,indexCol:b.indexCol,checkCol:b.checkCol,indexColWidth:25,cols:b.it,root:"list",width:"auto",height:"auto",fullWidthRows:!0,autoLoad:!0,noDataText:"\u5f53\u524d\u67e5\u8be2\u672a\u83b7\u53d6\u5230\u4efb\u4f55\u4fe1\u606f",url:b.url,items:b.it,cache:!1,sortStatus:"asc",nowrap:!1,method:"post",showBackboard:!1,params:b.params,plugins:[$(c).mmPaginator({style:"plain",totalCountName:"totalCount",page:1,pageParamName:"page",limitParamName:"count",limitLabel:"\u6bcf\u9875{0}\u6761",totalCountLabel:"\u5171\x3cspan\x3e{0}\x3c/span\x3e\u6761\u8bb0\u5f55",limit:b.it,limitList:[20,30,40,50]})]})},_do:function(a,b){var c=function(){bag.searchRest();common.creatSearch();void 0==mmg||null==mmg?mainCont.getList(a,b):mmg.load(_dataParams);mmg&&bag.mmgSelects()};common.codeFlag(function(){var a=$(".J-schools");common.getSchoolItem(a,{page:0,count:0},0,c)},function(){$(".J-schools").remove();c()})},mmgSelects:function(){mmg.on("cellSelected",function(a,b,c,d){datasCur=b;$(a.target).is(".J-tabs")&&(a.stopPropagation(),zhuangtaiTags=$(a.target).data("title"),tabOption=[{title:"\u7ad9\u70b9\u5217\u8868",content:'\x3cdiv class\x3d"tabs J-zhandian"\x3e\x3c/div\x3e'},{title:"\u8def\u7ebf\u4fe1\u606f",content:'\x3cdiv class\x3d"tabs J-luxian"\x3e\x3c/div\x3e'}],common.layerTabs(["960px","520px"],tabOption,edtiBox))})},ajaxSubmitV:function(a,b,c){$.ajax({type:"post",url:a,data:b,dataType:"json",beforeSend:function(){index=layer.load(1,{shade:[.1,"#fff"]})},success:function(a){ajaxDatas=a;c&&c()},complete:function(){layer.close(index)}})},searchRest:function(){$("#isUse").val("");$("#gender").val("");$("#keyWords").val("")}};bag._init();
//@ sourceMappingURL=yey-xiaoche.min.js.map